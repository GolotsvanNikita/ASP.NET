@{
    ViewBag.Title = "Guest book";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Scripts {
	<script>
        document.addEventListener("DOMContentLoaded", function(event)
        {
            getAllMessages();

            let row = function (student)
            {
                return "<tr data-rowid='" + student.Id + "'><td>" + student.Id + "</td>" +
                    "<td>" + student.Name + "</td> <td>" + student.Surname + "</td>" +
                    "<td>" + student.Age + "</td> <td>" + student.GPA + "</td>" +
                    "<td><a href='javascript: void (0)' data-studentid='" + student.Id +
                    "' class='btn btn-success btn-get-student'>Get Student</a></td></tr>";
            };

            async function getAllMessages()
            {
                const response = await fetch('https://localhost:7010/Home/GetMessage',
                    {
                        method: 'GET',
                    });

                    if (!response.ok)
                    {
                        alert("Error");
                    }
                    else
                    {
                        const messages = JSON.parse(await response.json());
                        let rows = "";
                        messages.forEach((Message, index) =>
                        {
                            rows += row(student);
                        });
                        document.getElementById("message-list").innerHTML = rows;
                    }
            }
            $(document).ready(function ()
                    {
                        $('#addMessageForm').on('submit', function (e)
                        {
                            e.preventDefault();
                            var message = $('textarea[name="message"]', this).val();
                            if (!message)
                            {
                                return;
                            }
                            $.ajax
                            ({
                                url: '/Home/AddMessage',
                                type: 'POST',
                                contentType: 'application/json',
                                data: JSON.stringify({ message: message }),
                                dataType: 'html',
                                success: function (data)
                                {
                                    $('#messages').prepend(data);
                                    $('textarea[name="message"]').val('');
                                }
                            });
                        });
                    });
        }
	</script>
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}
}
<h1>Messages</h1>


<form id="addMessageForm" asp-action="AddMessage" method="post">
    <div class="form-group">
        <textarea name="message" rows="4" cols="50" placeholder="Enter message"></textarea>
    </div>
    <input type="submit" value="Add message" class="btn btn-primary" />
</form>


<div id="messages">
    <table class="table table-bordered">
        <thead>
            <tr>
                <td>User</td>
                <td>Message</td>
                <td>Date</td>
            </tr>
        </thead>
        <tbody id="message-list">
        </tbody>
    </table>
</div>