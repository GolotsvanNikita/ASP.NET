@model ICollection<GuestBook.Models.Message>

@{
    ViewBag.Title = "Guest book";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>@Resource.NameOfBook</h1>

@if (Context.Session.GetString("Name") != null)
{
    <form id="addMessageForm" asp-action="AddMessage" method="post">
        <div class="form-group">
            <textarea name="message" rows="4" cols="50" placeholder="@Resource.PlaceHoldText"></textarea>
        </div>
        <input type="submit" value="@Resource.BtnAdd" class="btn btn-primary" />
    </form>
}

<div id="messages">
    @foreach (var msg in Model)
    {
        @await Html.PartialAsync("_Message", msg)
    }
</div>

@section Scripts
{
    <script>
        $(document).ready(function ()
        {
            $('#addMessageForm').on('submit', function (e)
            {
                e.preventDefault();
                var message = $('textarea[name="message"]', this).val();
                if (!message)
                {
                    return;
                }
                $.ajax
                ({
                    url: '/Home/AddMessage',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ message: message }),
                    dataType: 'html',
                    success: function (data)
                    {
                        $('#messages').prepend(data);
                        $('textarea[name="message"]').val('');
                    }
                });
            });
        });
    </script>
}